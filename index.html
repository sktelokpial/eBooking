<!doctype html>
<html lang="ms">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistem Tempahan Makmal Komputer</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .booking-card {
            transition: all 0.3s ease;
        }
        .booking-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .time-slot {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .form-section {
            background: linear-gradient(135deg, #a7f3d0 0%, #6ee7b7 100%);
        }
        .schedule-section {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full bg-gradient-to-br from-blue-50 to-indigo-100">
  <div class="container mx-auto px-4 py-6"><!-- Header dengan Logo -->
   <div class="text-center mb-8"><img src="https://i.postimg.cc/pXm8mmQ3/unnamed.png" alt="Logo Sekolah" class="mx-auto mb-4 h-20 w-20 object-contain" onerror="this.style.display='none';">
    <h1 id="tajuk-sistem" class="text-4xl font-bold text-gray-800 mb-2">Sistem Tempahan Makmal Komputer</h1>
    <p id="nama-sekolah" class="text-xl text-gray-600">Sekolah Kebangsaan</p>
   </div>
   <div class="grid lg:grid-cols-2 gap-8"><!-- Borang Tempahan -->
    <div class="form-section rounded-2xl shadow-2xl p-8 text-white">
     <h2 class="text-2xl font-bold mb-6 text-center text-black">Borang Tempahan Baru</h2>
     <form id="booking-form" class="space-y-6"><!-- Nama Guru -->
      <div><label for="nama-guru" class="block text-sm font-semibold mb-2 text-black">Nama Guru</label> <select id="nama-guru" required class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-black focus:border-blue-500 focus:outline-none"> <option value="">Sila Pilih</option> <option value="EN MASRI BIN MAT SOM">EN MASRI BIN MAT SOM</option> <option value="EN MOHD SHUKRI BIN ABDULLAH">EN MOHD SHUKRI BIN ABDULLAH</option> <option value="PN MIMI HAFIZAH BINTI ADNAN">PN MIMI HAFIZAH BINTI ADNAN</option> <option value="EN MOHD ZAMRI BIN JAMALUDIN">EN MOHD ZAMRI BIN JAMALUDIN</option> <option value="PN WAN MURNI WATI BINTI MAT RANI">PN WAN MURNI WATI BINTI MAT RANI</option> <option value="EN MOHD SUHAIMI BIN OTHMAN">EN MOHD SUHAIMI BIN OTHMAN</option> <option value="PN NOR'AZIAH BT MOHD STAR">PN NOR'AZIAH BT MOHD STAR</option> <option value="PN RABEAH BT JAHAYA">PN RABEAH BT JAHAYA</option> <option value="PN.NOR FADILAH BT SAAT">PN.NOR FADILAH BT SAAT</option> <option value="PN NOR AZA BT YAHYA">PN NOR AZA BT YAHYA</option> <option value="PN AZIZAH BT MOKHTAR">PN AZIZAH BT MOKHTAR</option> <option value="EN MUHAMMAD HILMAN BIN ABD HALIM">EN MUHAMMAD HILMAN BIN ABD HALIM</option> <option value="PN NURUL ADIBAH BT MOHD SIBI">PN NURUL ADIBAH BT MOHD SIBI</option> <option value="PN SHUZANNA BINTI SHOIB">PN SHUZANNA BINTI SHOIB</option> <option value="EN ABD NASIR BIN SHAARANI">EN ABD NASIR BIN SHAARANI</option> <option value="PN NOR AFIFAH BT MAT SALIM">PN NOR AFIFAH BT MAT SALIM</option> <option value="PN NIK NORLINI BINTI NIK DIN">PN NIK NORLINI BINTI NIK DIN</option> <option value="PN JAMILAH BT MOKHTAR">PN JAMILAH BT MOKHTAR</option> <option value="PN SUHAILY BT MAT NOR">PN SUHAILY BT MAT NOR</option> <option value="PN NURUL IZZATI BT HASMI">PN NURUL IZZATI BT HASMI</option> </select>
      </div><!-- Nama Kelas -->
      <div><label for="nama-kelas" class="block text-sm font-semibold mb-2 text-black">Nama Kelas</label> <select id="nama-kelas" required class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-black focus:border-blue-500 focus:outline-none"> <option value="">Sila Pilih</option> <option value="PRASEKOLAH PINTAR">PRASEKOLAH PINTAR</option> <option value="TAHUN 1 CERDAS">TAHUN 1 CERDAS</option> <option value="TAHUN 2 CERDIK">TAHUN 2 CERDIK</option> <option value="TAHUN 3 BIJAK">TAHUN 3 BIJAK</option> <option value="TAHUN 4 PINTAR">TAHUN 4 PINTAR</option> <option value="TAHUN 5 MUMTAZ">TAHUN 5 MUMTAZ</option> <option value="TAHUN 6 GENIUS">TAHUN 6 GENIUS</option> <option value="LAIN-LAIN">LAIN-LAIN</option> </select>
      </div><!-- Subjek -->
      <div><label for="subjek" class="block text-sm font-semibold mb-2 text-black">Subjek</label> <select id="subjek" required class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-black focus:border-blue-500 focus:outline-none"> <option value="">Sila Pilih</option> <option value="BM">BM</option> <option value="BI">BI</option> <option value="MATE">MATE</option> <option value="SAINS">SAINS</option> <option value="BA">BA</option> <option value="PJ">PJ</option> <option value="PK">PK</option> <option value="PS">PS</option> <option value="MZ">MZ</option> <option value="PI">PI</option> <option value="ULM">ULM</option> <option value="TSMK">TSMK</option> <option value="SJ">SJ</option> <option value="RBT">RBT</option> <option value="LAIN-LAIN">LAIN-LAIN</option> </select>
      </div><!-- Tarikh -->
      <div><label class="block text-sm font-semibold mb-2 text-black">Tarikh</label>
       <div id="calendar-container" class="bg-white rounded-lg p-4 border-2 border-gray-300">
        <div id="calendar-header" class="text-center mb-3 font-semibold text-gray-800"></div>
        <div class="grid grid-cols-7 gap-1 text-center text-xs text-gray-600 mb-2">
         <div>
          Isn
         </div>
         <div>
          Sel
         </div>
         <div>
          Rab
         </div>
         <div>
          Kha
         </div>
         <div>
          Jum
         </div>
         <div>
          Sab
         </div>
         <div>
          Ahd
         </div>
        </div>
        <div id="calendar-dates" class="grid grid-cols-7 gap-1"><!-- Calendar dates will be populated here -->
        </div>
       </div><input type="hidden" id="selected-date" name="tarikh" required>
       <div id="selected-date-display" class="mt-2 text-sm text-black font-medium"></div>
      </div><!-- Slot Masa -->
      <div><label for="slot-masa" class="block text-sm font-semibold mb-2 text-black">Slot Masa</label> <select id="slot-masa" required class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-black focus:border-blue-500 focus:outline-none"> <option value="">Sila Pilih</option> <option value="07:30AM">07:30AM</option> <option value="08:00AM">08:00AM</option> <option value="08:30AM">08:30AM</option> <option value="09:00AM">09:00AM</option> <option value="09:30AM">09:30AM</option> <option value="10:00AM">10:00AM</option> <option value="10:20AM">10:20AM</option> <option value="10:50AM">10:50AM</option> <option value="11:20AM">11:20AM</option> <option value="11:50AM">11:50AM</option> <option value="12:20PM">12:20PM</option> <option value="12:50PM">12:50PM</option> <option value="02:00PM">02:00PM</option> <option value="02:30PM">02:30PM</option> <option value="03:00PM">03:00PM</option> <option value="03:30PM">03:30PM</option> <option value="04:00PM">04:00PM</option> </select>
      </div><!-- Alatan -->
      <div><label class="block text-sm font-semibold mb-3 text-black">Alatan Yang Digunakan</label>
       <div class="grid grid-cols-2 gap-3"><label class="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" value="Komputer" class="rounded border-white/20 bg-white/10 text-pink-500 focus:ring-pink-500"> <span class="text-sm text-black">Komputer</span> </label> <label class="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" value="Laptop" class="rounded border-white/20 bg-white/10 text-pink-500 focus:ring-pink-500"> <span class="text-sm text-black">Laptop</span> </label> <label class="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" value="Headphones" class="rounded border-white/20 bg-white/10 text-pink-500 focus:ring-pink-500"> <span class="text-sm text-black">Headphones</span> </label> <label class="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" value="Mouse murid" class="rounded border-white/20 bg-white/10 text-pink-500 focus:ring-pink-500"> <span class="text-sm text-black">Mouse murid</span> </label> <label class="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" value="LCD dan laptop guru" class="rounded border-white/20 bg-white/10 text-pink-500 focus:ring-pink-500"> <span class="text-sm text-black">LCD dan laptop guru</span> </label> <label class="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" value="Smartboard (akan datang)" class="rounded border-white/20 bg-white/10 text-pink-500 focus:ring-pink-500"> <span class="text-sm text-black">Smartboard (akan datang)</span> </label> <label class="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" value="Microphones" class="rounded border-white/20 bg-white/10 text-pink-500 focus:ring-pink-500"> <span class="text-sm text-black">Microphones</span> </label> <label class="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" value="Speaker" class="rounded border-white/20 bg-white/10 text-pink-500 focus:ring-pink-500"> <span class="text-sm text-black">Speaker</span> </label>
       </div>
      </div><button type="submit" id="submit-btn" class="w-full bg-white text-pink-600 font-bold py-3 px-6 rounded-lg hover:bg-gray-100 transition duration-300 transform hover:scale-105"> Hantar Tempahan </button>
     </form>
     <div id="message" class="mt-4 p-3 rounded-lg hidden"></div>
    </div><!-- Jadual Tempahan -->
    <div class="schedule-section rounded-2xl shadow-2xl p-8 text-white">
     <h2 class="text-2xl font-bold mb-6 text-center">Jadual Waktu Makmal Komputer</h2><!-- Week Navigation -->
     <div class="flex justify-between items-center mb-4"><button id="prev-week-btn" onclick="changeWeek(-1)" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center space-x-2"> <span>&lt;</span> <span>Minggu Sebelum</span> </button>
      <div id="current-week" class="text-center font-semibold text-lg"></div><button id="next-week-btn" onclick="changeWeek(1)" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center space-x-2"> <span>Minggu Berikutnya</span> <span>&gt;</span> </button>
     </div>
     <div id="booking-schedule" class="overflow-x-auto"><!-- Jadual waktu akan dipaparkan di sini -->
     </div>
    </div>
   </div>
  </div>
  <script>
        let bookings = [];
        let currentRecordCount = 0;
        let currentViewWeekOffset = 0; // 0 = current week, -1 = previous week, 1 = next week

        const defaultConfig = {
            tajuk_sistem: "Sistem Tempahan Makmal Komputer",
            nama_sekolah: ""
        };

        // Data handler untuk SDK
        const dataHandler = {
            onDataChanged(data) {
                bookings = data;
                currentRecordCount = data.length;
                updateScheduleDisplay();
                checkSlotAvailability();
            }
        };

        // Fungsi untuk mendapatkan tarikh minggu berdasarkan offset
        function getWeekDates(weekOffset = 0) {
            // Set today as October 30, 2025 (Khamis)
            const today = new Date(2025, 9, 30); // October 30, 2025
            const currentDay = today.getDay(); // 0=Ahad, 1=Isnin, ..., 6=Sabtu
            
            // Cari Isnin minggu ini
            const monday = new Date(today);
            const daysToMonday = currentDay === 0 ? -6 : 1 - currentDay;
            monday.setDate(today.getDate() + daysToMonday);
            
            // Adjust for week offset
            monday.setDate(monday.getDate() + (weekOffset * 7));
            
            const weekDates = [];
            const dayNames = ['Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat'];
            
            for (let i = 0; i < 5; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                
                // Boleh tempah jika tarikh adalah hari ini atau masa hadapan dalam minggu semasa sahaja
                const todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const canBook = date >= todayDate;
                
                weekDates.push({
                    date: date,
                    dayName: dayNames[i],
                    dateString: date.toISOString().split('T')[0],
                    displayDate: `${dayNames[i]}, ${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`,
                    canBook: canBook
                });
            }
            
            return weekDates;
        }

        // Fungsi untuk mendapatkan tarikh minggu semasa (untuk kalendar)
        function getCurrentWeekDates() {
            return getWeekDates(0);
        }

        // Helper function to get the start of the week (Monday)
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Adjust when day is Sunday
            return new Date(d.setDate(diff));
        }

        // Function to check if a date is bookable
        function isDateBookable(date) {
            // Set today as October 30, 2025 (Khamis)
            const today = new Date(2025, 9, 30); // October 30, 2025
            const todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const dayOfWeek = date.getDay();
            
            // Cannot book on Saturday (6) and Sunday (0)
            if (dayOfWeek === 0 || dayOfWeek === 6) return false;
            
            // Cannot book dates before today
            if (date < todayDate) return false;
            
            // Get the start of current week (Monday)
            const currentWeekStart = getWeekStart(today);
            
            // Get the start of next week (Monday of next week)
            const nextWeekStart = new Date(currentWeekStart);
            nextWeekStart.setDate(currentWeekStart.getDate() + 7);
            
            // Get the end of next week (Friday of next week)
            const nextWeekEnd = new Date(nextWeekStart);
            nextWeekEnd.setDate(nextWeekStart.getDate() + 4); // Friday
            
            // Can only book within current week and next week (Monday to Friday only)
            return date >= currentWeekStart && date <= nextWeekEnd;
        }

        // Calendar functionality
        let currentCalendarDate = new Date(2025, 9, 30); // Set to October 30, 2025 (month is 0-indexed)
        let selectedDate = null;

        function renderCalendar() {
            const calendarHeader = document.getElementById('calendar-header');
            const calendarDates = document.getElementById('calendar-dates');
            
            const monthNames = [
                'Januari', 'Februari', 'Mac', 'April', 'Mei', 'Jun',
                'Julai', 'Ogos', 'September', 'Oktober', 'November', 'Disember'
            ];
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            calendarHeader.innerHTML = `
                <div class="flex justify-between items-center">
                    <button type="button" onclick="changeMonth(-1)" class="px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">&lt;</button>
                    <span>${monthNames[month]} ${year}</span>
                    <button type="button" onclick="changeMonth(1)" class="px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">&gt;</button>
                </div>
            `;
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            // Fix day calculation - getDay() returns 0=Sunday, 1=Monday, etc.
            // We want Monday=0, Tuesday=1, etc. for our grid
            let startingDayOfWeek = firstDay.getDay() - 1;
            if (startingDayOfWeek < 0) startingDayOfWeek = 6; // Sunday becomes 6
            
            // Get today's date for comparison - October 30, 2025
            const today = new Date(2025, 9, 30); // October 30, 2025
            const todayString = today.toISOString().split('T')[0];
            
            calendarDates.innerHTML = '';
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'h-8';
                calendarDates.appendChild(emptyCell);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateString = date.toISOString().split('T')[0];
                
                // Use the new booking logic
                const canBook = isDateBookable(date);
                
                const dayCell = document.createElement('div');
                dayCell.className = `h-8 w-8 flex items-center justify-center text-sm rounded transition-all duration-200 ${
                    canBook 
                        ? 'cursor-pointer hover:bg-blue-100 text-gray-800 hover:scale-110' 
                        : 'text-gray-400 cursor-not-allowed'
                } ${
                    selectedDate === dateString 
                        ? 'bg-blue-500 text-white font-bold shadow-lg' 
                        : 'bg-white'
                } ${
                    dateString === todayString 
                        ? 'ring-2 ring-blue-300' 
                        : ''
                }`;
                
                dayCell.textContent = day;
                
                if (canBook) {
                    dayCell.addEventListener('click', () => selectDate(dateString, date));
                }
                
                calendarDates.appendChild(dayCell);
            }
            
            // Calendar display is separate from schedule display
        }

        function changeMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            renderCalendar();
        }

        function selectDate(dateString, date) {
            selectedDate = dateString;
            document.getElementById('selected-date').value = dateString;
            
            // Create a new date object from the dateString to ensure correct date
            const selectedDateObj = new Date(dateString + 'T00:00:00');
            const dayNames = ['Ahad', 'Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat', 'Sabtu'];
            const dayName = dayNames[selectedDateObj.getDay()];
            const displayText = `Tarikh dipilih: ${dayName}, ${selectedDateObj.getDate()}/${selectedDateObj.getMonth() + 1}/${selectedDateObj.getFullYear()}`;
            document.getElementById('selected-date-display').textContent = displayText;
            
            renderCalendar();
            checkSlotAvailability();
        }

        // Check slot availability
        function checkSlotAvailability() {
            const selectedDateValue = document.getElementById('selected-date').value;
            const slotSelect = document.getElementById('slot-masa');
            
            if (selectedDateValue && slotSelect.value) {
                const isBooked = bookings.some(booking => 
                    booking.tarikh === selectedDateValue && 
                    booking.slot_masa === slotSelect.value
                );
                
                if (isBooked) {
                    showMessage('Slot masa ini telah ditempah untuk tarikh yang dipilih. Sila pilih slot lain.', 'error');
                    slotSelect.value = '';
                }
            }
        }

        // Update schedule display
        function updateScheduleDisplay() {
            const scheduleDiv = document.getElementById('booking-schedule');
            const weekDates = getWeekDates(currentViewWeekOffset);
            
            // Update week display
            const currentWeekDiv = document.getElementById('current-week');
            const firstDate = weekDates[0].date;
            const lastDate = weekDates[4].date;
            
            let weekLabel = '';
            if (currentViewWeekOffset === 0) {
                weekLabel = 'Minggu Semasa: ';
            } else if (currentViewWeekOffset === -1) {
                weekLabel = 'Minggu Sebelum: ';
            } else if (currentViewWeekOffset === 1) {
                weekLabel = 'Minggu Berikutnya: ';
            } else {
                weekLabel = 'Minggu: ';
            }
            
            currentWeekDiv.textContent = `${weekLabel}${firstDate.getDate()}/${firstDate.getMonth() + 1} - ${lastDate.getDate()}/${lastDate.getMonth() + 1}/${lastDate.getFullYear()}`;
            
            // Update button states
            updateWeekNavigationButtons();
            
            // Time slots for the timetable
            const timeSlots = [
                '07:30AM', '08:00AM', '08:30AM', '09:00AM', '09:30AM', '10:00AM',
                '10:20AM', '10:50AM', '11:20AM', '11:50AM', '12:20PM', '12:50PM',
                '02:00PM', '02:30PM', '03:00PM', '03:30PM', '04:00PM'
            ];
            
            // Create timetable HTML
            let timetableHTML = `
                <table class="w-full bg-white/10 rounded-lg overflow-hidden backdrop-blur-sm">
                    <thead>
                        <tr class="bg-white/20">
                            <th class="p-3 text-left font-bold border-b border-white/20">Masa</th>
            `;
            
            // Add day headers
            weekDates.forEach(dateInfo => {
                timetableHTML += `<th class="p-3 text-center font-bold border-b border-white/20 min-w-32">${dateInfo.dayName}<br><span class="text-sm font-normal">${dateInfo.date.getDate()}/${dateInfo.date.getMonth() + 1}</span></th>`;
            });
            
            timetableHTML += `
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // Add time slot rows
            timeSlots.forEach(timeSlot => {
                timetableHTML += `
                    <tr class="border-b border-white/10 hover:bg-white/5">
                        <td class="p-3 font-semibold border-r border-white/20">${timeSlot}</td>
                `;
                
                // Add cells for each day
                weekDates.forEach(dateInfo => {
                    const booking = bookings.find(b => 
                        b.tarikh === dateInfo.dateString && b.slot_masa === timeSlot
                    );
                    
                    if (booking) {
                        timetableHTML += `
                            <td class="p-2 border-r border-white/10">
                                <div class="time-slot rounded-lg p-2 text-white text-xs relative group">
                                    <div class="font-semibold truncate">${booking.nama_guru}</div>
                                    <div class="truncate opacity-90">${booking.nama_kelas}</div>
                                    <div class="truncate opacity-90">${booking.subjek}</div>
                                    <button onclick="deleteBooking('${booking.__backendId}')" 
                                            class="absolute top-1 right-1 bg-red-500 hover:bg-red-600 text-white w-5 h-5 rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
                                        Ã—
                                    </button>
                                    <div class="absolute bottom-0 left-0 right-0 bg-black/50 text-xs p-1 rounded-b-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                        ${booking.alatan}
                                    </div>
                                </div>
                            </td>
                        `;
                    } else {
                        timetableHTML += `
                            <td class="p-2 border-r border-white/10">
                                <div class="h-16 bg-white/5 rounded-lg flex items-center justify-center text-white/30 text-xs">
                                    Kosong
                                </div>
                            </td>
                        `;
                    }
                });
                
                timetableHTML += `</tr>`;
            });
            
            timetableHTML += `
                    </tbody>
                </table>
            `;
            
            scheduleDiv.innerHTML = timetableHTML;
        }

        // Change week view
        function changeWeek(direction) {
            currentViewWeekOffset += direction;
            updateScheduleDisplay();
        }

        // Update week navigation button states
        function updateWeekNavigationButtons() {
            const prevBtn = document.getElementById('prev-week-btn');
            const nextBtn = document.getElementById('next-week-btn');
            
            // You can view any week in the past or future for viewing purposes
            // No restrictions on viewing, only on booking
            prevBtn.disabled = false;
            nextBtn.disabled = false;
            
            // Update button appearance based on current view
            if (currentViewWeekOffset === 0) {
                prevBtn.className = "bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center space-x-2";
                nextBtn.className = "bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center space-x-2";
            } else {
                prevBtn.className = "bg-white/30 hover:bg-white/40 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center space-x-2";
                nextBtn.className = "bg-white/30 hover:bg-white/40 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center space-x-2";
            }
        }

        // Delete booking
        async function deleteBooking(bookingId) {
            const booking = bookings.find(b => b.__backendId === bookingId);
            if (!booking) return;
            
            const result = await window.dataSdk.delete(booking);
            if (result.isOk) {
                showMessage('Tempahan berjaya dipadam.', 'success');
            } else {
                showMessage('Ralat memadamkan tempahan.', 'error');
            }
        }

        // Show message
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `mt-4 p-3 rounded-lg ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`;
            messageDiv.classList.remove('hidden');
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }

        // Form submission
        document.getElementById('booking-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (currentRecordCount >= 999) {
                showMessage('Had maksimum 999 tempahan telah dicapai. Sila padam beberapa tempahan terlebih dahulu.', 'error');
                return;
            }
            
            const formData = new FormData(e.target);
            const tarikh = document.getElementById('selected-date').value;
            const slotMasa = document.getElementById('slot-masa').value;
            
            // Check for double booking
            const isDoubleBooked = bookings.some(booking => 
                booking.tarikh === tarikh && booking.slot_masa === slotMasa
            );
            
            if (isDoubleBooked) {
                showMessage('Slot masa ini telah ditempah. Sila pilih slot lain.', 'error');
                return;
            }
            
            // Get selected equipment
            const selectedEquipment = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                selectedEquipment.push(checkbox.value);
            });
            
            const bookingData = {
                id: Date.now().toString(),
                nama_guru: document.getElementById('nama-guru').value,
                nama_kelas: document.getElementById('nama-kelas').value,
                subjek: document.getElementById('subjek').value,
                tarikh: tarikh,
                slot_masa: slotMasa,
                alatan: selectedEquipment.join(', '),
                created_at: new Date(2025, 9, 30).toISOString()
            };
            
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Menghantar...';
            
            const result = await window.dataSdk.create(bookingData);
            
            if (result.isOk) {
                showMessage('Tempahan berjaya dihantar!', 'success');
                e.target.reset();
            } else {
                showMessage('Ralat menghantar tempahan. Sila cuba lagi.', 'error');
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'Hantar Tempahan';
        });

        // Add event listeners for slot checking
        document.getElementById('slot-masa').addEventListener('change', checkSlotAvailability);

        // Element SDK configuration
        async function onConfigChange(config) {
            const tajukElement = document.getElementById('tajuk-sistem');
            const sekolahElement = document.getElementById('nama-sekolah');
            
            if (tajukElement) {
                tajukElement.textContent = config.tajuk_sistem || defaultConfig.tajuk_sistem;
            }
            if (sekolahElement) {
                sekolahElement.textContent = config.nama_sekolah || defaultConfig.nama_sekolah;
            }
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["tajuk_sistem", config.tajuk_sistem || defaultConfig.tajuk_sistem],
                ["nama_sekolah", config.nama_sekolah || defaultConfig.nama_sekolah]
            ]);
        }

        // Initialize application
        async function initApp() {
            // Initialize Element SDK
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }

            // Initialize Data SDK
            if (window.dataSdk) {
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    console.error('Failed to initialize data SDK');
                }
            }

            // Initialize calendar
            renderCalendar();
        }

        // Start application when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99680a16f379fc5d',t:'MTc2MTc5NzE4MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
